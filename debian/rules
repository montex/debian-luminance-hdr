#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk
include /usr/share/cdbs/1/class/qmake.mk

# Force using qt4
QMAKE=qmake-qt4

# Don't use the default /usr/local prefix
DEB_QMAKE_ARGS="PREFIX=/usr"

# No need to install them
NOT_NEEDED=AUTHORS INSTALL LICENSE README Changelog

# Generated manpage
MANPAGE=debian/qtpfsgui.1

build/qtpfsgui::
	# Build the minimal manpage
	pod2man --center='Minimal qtpfsgui manpage' \
		--release=$(DEB_VERSION) \
		debian/qtpfsgui.pod > $(MANPAGE)

install/qtpfsgui::
	# Move the doc where it belongs
	mkdir -p $(DEB_DESTDIR)/usr/share/doc/qtpfsgui
	mv $(DEB_DESTDIR)/usr/share/qtpfsgui/html \
		$(DEB_DESTDIR)/usr/share/doc/qtpfsgui

	# Remove unneeded files
	for i in $(NOT_NEEDED); do \
		rm $(DEB_DESTDIR)/usr/share/qtpfsgui/$$i ; \
	done

	# Install the minimal manpage
	dh_installman $(MANPAGE)

# Use a stamp-file to avoid double-run
LOCALIZATION_STAMP=debian/stamp-localization

makebuilddir/qtpfsgui:: $(LOCALIZATION_STAMP)
$(LOCALIZATION_STAMP):
	# Generate localization files before qmake is run
	lrelease-qt4 project.pro
	touch $@

clean::
	# Delete generated binary files
	rm -f i18n/*.qm $(LOCALIZATION_STAMP) $(MANPAGE)
